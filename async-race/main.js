(()=>{"use strict";function n(n){return`\n    <?xml version="1.0" standalone="no"?>\n    <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"\n    "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">\n    <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="90" height="35" viewBox="0 0 1280.000000 640.000000" preserveAspectRatio="xMidYMid meet">\n      <g transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)" fill="${n}" stroke="none">\n      <path d="M3525 5341 c-72 -18 -79 -28 -90 -121 -4 -30 -11 -62 -16 -71 -4 -9 -97 -51 -206 -94 -774 -304 -1348 -540 -1603 -661 -163 -77 -222 -91 -421 -104 -85 -5 -170 -14 -189 -20 -101 -32 -362 -58 -620 -63 l-115 -2 -47 -80 c-47 -78 -47 -80 -29 -100 34 -36 35 -77 5 -177 -30 -99 -34 -178 -19 -370 5 -67 4 -88 -6 -88 -29 0 -83 -56 -110 -114 -50 -106 -74 -343 -48 -467 13 -58\n      13 -62 3 -159 -5 -54 16 -238 28 -244 2 -1 29 -20 61 -41 73 -49 123 -103 132 -143 17 -79 167 -155 355 -181 104 -15 969 -97 1087 -104 l32 -2 5 160 c7 230 50 394 146 559 281 479 917 673 1405 429 316 -159 530 -424 598 -742 22 -106 29 -365 13 -519 l-8 -82 3002 0 c2855 0 3002 1 2995 18 -33 87 -56 325 -45 461 28 320 177 567 459 759 399 273 847 282 1243 24 239 -157 397 -392 460\n      -687 18 -84 15 -341 -5 -430 -8 -38 -14 -71 -12 -73 7 -8 386 20 478 34 180 28 253 65 304 152 24 41 28 57 28 127 -1 44 -9 117 -20 163 -18 79 -18 88 -2 190 31 199 40 306 41 497 1 176 -1 195 -23 260 -46 135 -103 190 -283 274\n      -222 104 -633 220 -1168 330 -523 108 -1524 210 -2054 211 l-229 0 -236 139 c-813 477 -1593 884 -1852 966 -498 157 -1598 195 -2892 100 l-188 -14 -47 30 c-92 58 -223 89 -297 70z m1912 -311 c13 -45 58 -305 88 -515 33 -226 74 -539 71 -542 -7 -7 -1672 40 -2054 58 -357 16 -464 56 -573 215 -62 91 -87 225 -59 326 12 40 56 74 192 148 369 198 799 289 1618 340 246 15 290 16 510 16 l194\n      -1 13 -45z m649 10 c383 -36 717 -86 934 -139 210 -52 451 -163 720 -332 141\n      -88 379 -259 380 -271 0 -5 -14 -8 -32 -8 -48 0 -114 -37 -140 -78 -24 -39\n      -30 -113 -15 -189 l9 -43 -904 0 -904 0 -176 540 -175 540 47 0 c25 0 141 -9\n      256 -20z"/>\n      <path d="M2617 3125 c-431 -82 -774 -440 -838 -875 -17 -117 -7 -292 24 -410\n      113 -436 497 -751 947 -777 507 -29 959 313 1076 813 28 117 26 348 -4 467\n      -94 378 -383 670 -760 768 -105 27 -336 34 -445 14z m378 -310 c84 -21 209\n      -85 280 -142 116 -94 210 -242 251 -393 23 -87 24 -260 0 -355 -58 -237 -242\n      -439 -473 -519 -531 -186 -1074 277 -969 828 30 152 94 274 206 386 111 110\n      237 178 385 206 84 16 235 11 320 -11z"/>\n      <path d="M2918 2568 c2 -90 7 -167 12 -172 17 -17 108 58 201 166 l51 57 -48\n      31 c-52 33 -131 65 -185 75 l-34 6 3 -163z"/>\n      <path d="M2591 2700 c-62 -22 -167 -82 -164 -94 3 -13 237 -216 249 -216 7 0\n      15 7 18 16 8 20 8 127 -1 232 -7 95 -8 96 -102 62z"/>\n      <path d="M3209 2355 c-57 -64 -105 -123 -107 -131 -6 -25 46 -35 157 -29 58 3\n      121 8 139 11 33 5 34 6 27 42 -7 44 -64 167 -92 201 l-19 24 -105 -118z"/>\n      <path d="M2260 2409 c-31 -44 -68 -133 -77 -186 l-6 -33 155 0 c165 0 201 9\n      181 44 -13 24 -204 216 -214 216 -5 0 -22 -18 -39 -41z"/>\n      <path d="M2786 2354 c-36 -35 0 -87 44 -64 26 14 26 56 1 70 -25 13 -27 13\n      -45 -6z"/>\n      <path d="M2751 2186 c-57 -32 -68 -111 -22 -157 43 -42 101 -43 143 -1 42 42\n      41 100 -1 143 -33 32 -78 38 -120 15z"/>\n      <path d="M2560 2136 c-19 -23 -8 -61 18 -64 44 -7 67 32 36 62 -19 20 -38 20\n      -54 2z"/>\n      <path d="M3002 2124 c-27 -19 -28 -36 -3 -58 25 -23 61 -6 61 29 0 33 -30 49\n      -58 29z"/>\n      <path d="M2245 1993 c-77 -6 -76 -5 -59 -65 16 -55 61 -146 92 -186 l18 -23\n      103 122 c57 67 104 129 105 138 1 14 -14 16 -104 17 -58 0 -127 -1 -155 -3z"/>\n      <path d="M3165 1981 c-44 -4 -61 -10 -63 -22 -3 -16 210 -229 228 -229 22 0\n      86 141 105 228 l7 32 -109 -2 c-59 -1 -135 -4 -168 -7z"/>\n      <path d="M2776 1914 c-19 -18 -19 -20 -6 -45 6 -11 21 -19 35 -19 20 0 45 24\n      45 44 0 10 -32 36 -45 36 -7 0 -21 -7 -29 -16z"/>\n      <path d="M2589 1743 c-86 -90 -139 -151 -139 -162 0 -25 179 -101 236 -101\n      l27 0 -7 143 c-9 166 -13 187 -35 187 -9 0 -46 -30 -82 -67z"/>\n      <path d="M2936 1801 c-6 -10 -24 -168 -29 -258 -3 -60 -2 -63 19 -63 79 0 262\n      68 248 92 -5 7 -53 64 -108 126 -93 105 -117 124 -130 103z"/>\n      <path d="M10723 3125 c-318 -58 -597 -266 -743 -555 -223 -441 -98 -996 289\n      -1288 112 -84 188 -125 311 -166 274 -91 545 -70 802 61 552 282 735 983 392\n      1500 -225 339 -651 521 -1051 448z m385 -315 c348 -98 579 -443 532 -796 -67\n      -508 -596 -796 -1055 -574 -239 116 -396 352 -412 620 -20 335 192 640 516\n      745 122 40 289 42 419 5z"/>\n      <path d="M11017 2568 c3 -90 9 -167 14 -172 13 -14 53 18 155 122 l95 97 -23\n      18 c-50 40 -189 97 -235 97 -10 0 -11 -33 -6 -162z"/>\n      <path d="M10705 2706 c-50 -16 -133 -58 -163 -82 l-23 -19 121 -107 c67 -60\n      128 -108 135 -108 23 0 27 39 20 186 -8 162 -4 157 -90 130z"/>\n      <path d="M11307 2354 c-59 -65 -107 -126 -107 -136 0 -11 11 -18 38 -22 44 -7\n      278 7 289 17 15 16 -51 183 -94 236 l-19 24 -107 -119z"/>\n      <path d="M10362 2413 c-39 -62 -70 -134 -78 -184 l-7 -39 152 0 c86 0 161 5\n      172 10 17 10 18 13 5 38 -8 15 -59 71 -114 125 l-99 99 -31 -49z"/>\n      <path d="M10888 2359 c-24 -14 -23 -56 2 -69 44 -23 80 29 44 64 -18 19 -23\n      19 -46 5z"/>\n      <path d="M10851 2187 c-49 -29 -66 -101 -35 -146 9 -13 32 -29 50 -37 29 -12\n      39 -12 68 0 99 41 85 180 -19 192 -24 3 -50 -1 -64 -9z"/>\n      <path d="M10660 2136 c-19 -23 -8 -61 18 -64 44 -7 67 32 36 62 -19 20 -38 20\n      -54 2z"/>\n      <path d="M11096 2124 c-9 -8 -16 -22 -16 -29 0 -13 26 -45 36 -45 20 0 44 25\n      44 45 0 14 -8 29 -19 35 -25 13 -27 13 -45 -6z"/>\n      <path d="M10335 1991 c-60 -6 -60 -6 -57 -36 9 -69 104 -248 122 -229 57 61\n      210 250 207 258 -4 12 -176 17 -272 7z"/>\n      <path d="M11267 1983 c-68 -5 -79 -19 -47 -60 23 -31 200 -193 210 -193 3 0\n      20 24 37 53 29 48 52 111 67 180 l6 27 -107 -2 c-60 -1 -134 -3 -166 -5z"/>\n      <path d="M10870 1910 c-16 -31 4 -62 38 -58 21 2 28 9 30 32 5 45 -47 65 -68\n      26z"/>\n      <path d="M10651 1703 c-56 -59 -101 -113 -101 -120 0 -28 172 -103 237 -103\n      l26 0 -7 123 c-10 179 -15 207 -36 207 -10 0 -63 -48 -119 -107z"/>\n      <path d="M11035 1801 c-7 -12 -23 -144 -29 -243 -4 -77 -4 -78 19 -78 45 0\n      130 22 193 51 l64 29 -19 23 c-65 82 -198 227 -209 227 -7 0 -15 -4 -19 -9z"/>\n      </g>\n    </svg>\n  `}function t(t){return`\n    <h1 class="main-title">Garage (${t.carsCount})</h1>\n    <h2 class="second-title">Page #${t.carsPage}</h2>\n    <ul class="cars-list">\n      ${t.cars.map((t=>`\n        <li>${function({id:t,name:e,color:a,isEngineStarted:i}){return`\n    <div class="car-wrapper">\n      <div class="general-buttons">\n        <button class="button select-button" id="select-car-${t}">Select</button>\n        <button class="button remove-button" id="remove-car-${t}">Remove</button>\n        <span class="car-name">${e}</span>\n      </div>\n      <div class="road">\n        <div class="car-panel">\n            <div class="control-panel">\n              <button class="button icon start-engine-button" id="start-engine-car-${t}" ${i?"disabled":""}>A</button>\n              <button class="button icon stop-engine-button" id="stop-engine-car-${t}" ${i?"disabled":""}>B</button>\n            </div>\n            <div class="car" id="car-${t}">\n              ${n(a)}\n            </div>\n        </div>\n        <div class="flag" id="flag-${t}">&#9873;</div>\n      </div>\n    </div>    \n  `}(t)}</li>\n      `)).join("")}\n    </ul>\n  `}function e(t){return`\n    <h1 class="main-title">Winners (${t.winnersCount})</h1>\n    <h2 class="second-title">Page #${t.winnersPage}</h2>\n    <table class="table" cellspacing="0" border="0" cellpadding="0">\n      <thead>\n        <th>Number</th>\n        <th>Car</th>\n        <th>Name</th>\n        <th class="table-button table-wins ${"wins"===t.sortBy?t.sortOrder:""}" id="sort-by-wins">Wins</th>\n        <th class="table-button table-time ${"time"===t.sortBy?t.sortOrder:""}" id="sort-by-wins">Best time (seconds)</th>\n      </thead>\n      <tbody>\n        ${t.winners.map(((t,e)=>`\n          <tr>\n            <td>${e+1}</td>\n            <td>${n(t.car.color)}</td>\n            <td>${t.car.name}</td>\n            <td>${t.wins}</td>\n            <td>${t.time}</td>\n          </tr>\n        `)).join("")}\n      </tbody>\n    </table>\n  `}const a="http://localhost:3000",i=`${a}/garage`,s=`${a}/engine`,c=`${a}/winners`;async function o(n,t=7){const e=await fetch(`${i}?_page=${n}&_limit=${t}`);return{items:await e.json(),count:e.headers.get("X-Total-Count")}}async function d(n){return(await fetch(`${i}/${n}`)).json()}async function r(n){return(await fetch(i,{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}})).json()}async function l({page:n,limit:t=10,sort:e,order:a}){const i=function(n,t){return n&&t?`&_sort=${n}&_order=${t}`:""}(e,a),s=await fetch(`${c}?_page=${n}&_limit=${t}${i}`),o=await s.json();return{items:await Promise.all(o.map((async n=>({...n,car:await d(n.id)})))),count:s.headers.get("X-Total-Count")}}function u(n){if(!n)return null;const{top:t,left:e,width:a,height:i}=n.getBoundingClientRect();return{x:e+a/2,y:t+i/2}}async function m(n,t,e){const{success:a,id:i,time:s}=await Promise.race(t);if(!a){const a=e.findIndex((n=>n===i));return m(n,[...t.slice(0,a),...t.slice(a+1,t.length)],[...e.slice(0,a),...e.slice(a+1,e.length)])}return{...n.cars.find((n=>n.id===i)),time:+(s/1e3).toFixed(2)}}async function g(n,t){const e=n.cars.map((e=>t(n,e.id)));return await m(n,e,n.cars.map((n=>n.id)))}const p=["Tesla","Mercedes","Mazda","Audi","Ferrari","Honda","BMW","Lamborghini","Citroen","Toyota"],y=["CLA","CX-5","Camry","Accord","SS","RX-8","Z4","1000","GLA","A7"];function w(){let n="#";for(let t=0;t<6;t++)n+="0123456789ABCDEF"[Math.floor(16*Math.random())];return n}async function b(n,t){document.getElementById(`start-engine-car-${t}`).disabled=!0,document.getElementById(`stop-engine-car-${t}`).disabled=!1;const{velocity:e,distance:a}=await async function(n){return(await fetch(`${s}?id=${n}&status=started`)).json()}(t),i=document.getElementById(`car-${t}`),c=document.getElementById(`flag-${t}`),o=Math.round(a/e),d=Math.floor(function(n,t){const e=u(n),a=u(t);return e&&a?Math.hypot(e.x-a.x,e.y-a.y):0}(i,c))+50,r=await async function(n,t,e){let a=0;const i={id:null};return i.id=window.requestAnimationFrame((function s(c){a||(a=c);const o=c-a,d=Math.round(o*(t/e));n&&(n.style.transform=`translateX(${Math.min(d,t)}px)`),d<t&&(i.id=window.requestAnimationFrame(s))})),i}(i,d,o);n.animation.id=r.id;const{success:l}=await async function(n){const t=await fetch(`${s}?id=${n}&status=drive`).catch();return 200!==t.status?{success:!1}:{...await t.json()}}(t);return l||window.cancelAnimationFrame(r.id),{success:l,id:t,time:o}}async function h(n,t){document.getElementById(`stop-engine-car-${t}`).disabled=!0,await async function(n){return(await fetch(`${s}?id=${n}&status=stopped`)).json()}(t),document.getElementById(`start-engine-car-${t}`).disabled=!1,document.getElementById(`car-${t}`).style.transform="translateX(0)",n.animation.id&&window.cancelAnimationFrame(n.animation.id)}let f=null;function v(n){var a,s;document.body.addEventListener("click",(async a=>{const s=a.target;if(s.classList.contains("start-engine-button")){const t=+s.id.split("start-engine-car-")[1];b(n,t)}if(s.classList.contains("stop-engine-button")){const t=+s.id.split("stop-engine-car-")[1];h(n,t)}if(s.classList.contains("select-button")&&(f=await d(+s.id.split("select-car-")[1]),f&&(document.getElementById("update-name").value=f.name,document.getElementById("update-color").value=f.color,document.getElementById("update-name").disabled=!1,document.getElementById("update-color").disabled=!1,document.getElementById("update-submit").disabled=!1)),s.classList.contains("remove-button")){const e=+s.id.split("remove-car-")[1];await async function(n){try{return(await fetch(`${i}/${n}`,{method:"DELETE"})).json()}catch(n){console.log(n)}}(e),await async function(n){try{return(await fetch(`${c}/${n}`,{method:"DELETE"})).json()}catch(n){console.log(n)}}(e),await $(n),document.getElementById("garage").innerHTML=t(n)}if(s.classList.contains("generator-button")){s.disabled=!0;const e=function(n=100){return new Array(n).fill(1).map((n=>({name:`${p[Math.floor(Math.random()*p.length)]} ${y[Math.floor(Math.random()*y.length)]}`,color:w()})))}();await Promise.all(e.map((async n=>await r(n)))),await $(n),document.getElementById("garage").innerHTML=t(n),s.disabled=!1}if(s.classList.contains("race-button")){s.disabled=!0;const t=await g(n,((n,t)=>b(n,t)));await async function({id:n,time:t}){if(404===await async function(n){return(await fetch(`${c}/${n}`)).status}(n))await async function(n){return(await fetch(c,{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}})).json()}({id:n,wins:1,time:t});else{const e=await async function(n){return(await fetch(`${c}/${n}`)).json()}(n);await async function(n,t){return(await fetch(`${c}/${n}`,{method:"PUT",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})).json()}(n,{id:n,wins:e.wins+1,time:t<e.time?t:e.time})}}(t);const e=document.getElementById("message");e.innerHTML=`${t.name} went first ${t.time}s!`,null==e||e.classList.toggle("visible",!0),document.getElementById("reset").disabled=!1}if(s.classList.contains("reset-button")){s.disabled=!0,n.cars.map((({id:t})=>h(n,t)));const t=document.getElementById("message");null==t||t.classList.toggle("visible",!1),document.getElementById("race").disabled=!1}if(s.classList.contains("prev-button"))switch(n.view){case"garage":if(n.carsPage<2)return;n.carsPage--,await $(n),document.getElementById("garage").innerHTML=t(n);break;case"winners":n.winnersPage--,await $(n),document.getElementById("winners-view").innerHTML=t(n)}if(s.classList.contains("next-button"))switch(n.view){case"garage":n.carsPage++,await $(n),document.getElementById("garage").innerHTML=t(n);break;case"winners":n.winnersPage++,await $(n),document.getElementById("winners-view").innerHTML=t(n)}s.classList.contains("garage-menu-button")&&(document.getElementById("garage-view").style.display="block",document.getElementById("winners-view").style.display="none"),s.classList.contains("winners-menu-button")&&(document.getElementById("winners-view").style.display="block",document.getElementById("garage-view").style.display="none",await E(n),document.getElementById("winners-view").innerHTML=e(n)),s.classList.contains("table-wins")&&B(n,"wins"),s.classList.contains("table-time")&&B(n,"time")})),null===(a=document.getElementById("create"))||void 0===a||a.addEventListener("submit",(async e=>{e.preventDefault();const a={name:document.getElementById("create-name").value,color:document.getElementById("create-color").value};await r(a),await $(n),document.getElementById("garage").innerHTML=t(n),document.getElementById("create-name").value="",e.target.disabled="true"})),null===(s=document.getElementById("update"))||void 0===s||s.addEventListener("submit",(async e=>{e.preventDefault();const a={name:document.getElementById("update-name").value,color:document.getElementById("update-color").value};f&&await async function(n,t){(await fetch(`${i}/${n}`,{method:"PUT",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})).json()}(f.id,a),await $(n),document.getElementById("garage").innerHTML=t(n),document.getElementById("update-name").value="",document.getElementById("update-name").disabled=!0,document.getElementById("update-color").disabled=!0,document.getElementById("update-submit").disabled=!0,document.getElementById("update-color").value="#ffffff",f=null}))}async function $(n){const{items:t,count:e}=await o(n.carsPage);n.cars=t,n.carsCount=e,7*n.carsPage<+n.carsCount?document.getElementById("next").disabled=!1:document.getElementById("next").disabled=!0,n.carsPage>1?document.getElementById("prev").disabled=!1:document.getElementById("prev").disabled=!0}async function E(n){const{items:t,count:e}=await l({page:n.winnersPage,limit:10,sort:n.sortBy,order:n.sortOrder});n.winners=t,n.winnersCount=e,10*n.winnersPage<+n.winnersCount?document.getElementById("next").disabled=!1:document.getElementById("next").disabled=!0,n.winnersPage>1?document.getElementById("prev").disabled=!1:document.getElementById("prev").disabled=!0}async function B(n,t){n.sortOrder="asc"===n.sortOrder?"desc":"asc",n.sortBy=t,await E(n),document.getElementById("winners-view").innerHTML=e(n)}window.onload=async()=>{const n=await async function(){const{items:n,count:t}=await o(1),{items:e,count:a}=await l({page:1,limit:10,order:null,sort:null});return{carsPage:1,cars:n,carsCount:t,winnersPage:1,winners:e,winnersCount:a,animation:{id:null},view:"garage",sortBy:"",sortOrder:""}}();!function(n){const a=`\n    <div class="menu">\n      <button class="button garage-menu-button primary" id="garage-menu">To garage</button>\n      <button class="button winners-menu-button primary" id="winners-menu">To winners</button>\n    </div>\n    <div id="garage-view"> \n      <div>\n        <form class="form" id="create">\n          <input class="input" id="create-name" name="name" type="text" value="">  \n          <input class="color" id="create-color" name="color" type="color" value="#8000ff">  \n          <button class="button" type="submit">Create</button>\n        </form>\n        <form class="form" id="update">\n          <input class="input" id="update-name" name="name" type="text" disabled value="">  \n          <input class="color" id="update-color" name="color" type="color" value="#ffffff" disabled>  \n          <button class="button" id="update-submit" type="submit" disabled>Update</button>\n        </form>\n      </div>\n      <div class="race-controls">\n        <button class="button race-button primary" id="race">Race</button>\n        <button class="button reset-button primary" id="reset">Reset</button>\n        <button class="button generator-button" id="generator">Generate cars</button>\n      </div>\n      <div id="garage">\n        ${t(n)}\n      </div>\n      <div>\n        <p class="message" id="message"></p>\n      </div>\n    </div>\n    <div id="winners-view" style="display: none">  \n      ${e(n)}\n    </div>\n    <div class="pagination">\n      <button class="button primary prev-button" id="prev">Prev</button>\n      <button class="button primary next-button" id="next">Next</button>\n    </div>\n  `,i=document.createElement("div");i.classList.add("main"),i.innerHTML=a,document.body.appendChild(i)}(n),v(n),E(n)}})();